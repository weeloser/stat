<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—á–µ—Ç—á–∏–∫ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="https://i.ibb.co/2Yg0Wn4/favicon.png" type="image/png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        :root {
            --bg-primary-light: #f4f7fe;
            --bg-secondary-light: #ffffff;
            --text-primary-light: #111827;
            --text-secondary-light: #4b5563;
            --border-light: #e5e7eb;
            --accent-primary: #4f46e5;
            --accent-secondary: #7c3aed;
            --accent-gradient: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            --success-light: #10b981;
            --danger-light: #ef4444;
            --success-bg-light: #f0fdf4;
            --danger-bg-light: #fef2f2;
            --success-border-light: #a7f3d0;
            --danger-border-light: #fecaca;
            --gray-bg-light: #f3f4f6;

            --bg-primary-dark: #111827;
            --bg-secondary-dark: #1f2937;
            --text-primary-dark: #f9fafb;
            --text-secondary-dark: #9ca3af;
            --border-dark: #374151;
            --success-dark: #34d399;
            --danger-dark: #f87171;
            --success-bg-dark: #052e16;
            --danger-bg-dark: #450a0a;
            --success-border-dark: #15803d;
            --danger-border-dark: #b91c1c;
            --gray-bg-dark: #374151;
        }

        [data-theme="light"] {
            --bg-primary: var(--bg-primary-light);
            --bg-secondary: var(--bg-secondary-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --border-color: var(--border-light);
            --success-color: var(--success-light);
            --danger-color: var(--danger-light);
            --success-bg: var(--success-bg-light);
            --danger-bg: var(--danger-bg-light);
            --success-border: var(--success-border-light);
            --danger-border: var(--danger-border-light);
            --gray-bg: var(--gray-bg-light);
        }

        [data-theme="dark"] {
            --bg-primary: var(--bg-primary-dark);
            --bg-secondary: var(--bg-secondary-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --border-color: var(--border-dark);
            --success-color: var(--success-dark);
            --danger-color: var(--danger-dark);
            --success-bg: var(--success-bg-dark);
            --danger-bg: var(--danger-bg-dark);
            --success-border: var(--success-border-dark);
            --danger-border: var(--danger-border-dark);
            --gray-bg: var(--gray-bg-dark);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body.animations-disabled *,
        body.animations-disabled *::before,
        body.animations-disabled *::after {
             animation: none !important;
             transition: none !important;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 2rem auto;
            padding: 1rem;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .main-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-image: var(--accent-gradient);
            color: white;
            box-shadow: 0 4px 15px -5px rgba(79, 70, 229, 0.6);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px -5px rgba(79, 70, 229, 0.5);
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
             background-color: var(--gray-bg);
        }
        
        .btn-icon {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 0.6rem;
            border-radius: 0.75rem;
        }
        .btn-icon:hover {
            background: var(--gray-bg);
            color: var(--accent-primary);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--bg-secondary);
            border-radius: 1.5rem;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95) translateY(10px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        .modal-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2rem;
            text-align: center;
        }
        .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 99px;
            line-height: 1;
        }
        .close-button:hover {
            background-color: var(--gray-bg);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            border: 1px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        
        .statistic-card {
            background-color: var(--bg-secondary);
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -2px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border-color);
            cursor: pointer;
            opacity: 0;
        }
        .statistic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -4px rgba(0,0,0,0.07);
        }
        
        .trade-card {
            background-color: var(--bg-secondary);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: background-color 0.2s ease, transform 0.2s ease;
            cursor: pointer;
            opacity: 0;
        }
        .trade-card:hover {
            background-color: var(--bg-primary);
            transform: translateY(-3px);
        }

        .profit-loss-green { background-color: var(--success-bg); color: var(--success-color); }
        .profit-loss-red { background-color: var(--danger-bg); color: var(--danger-color); }
        .profit-loss-gray { background-color: var(--gray-bg); color: var(--text-secondary); }

        .color-green { color: var(--success-color); }
        .color-red { color: var(--danger-color); }
        .color-gray { color: var(--text-secondary); }
        
        #toast {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            font-weight: 500;
        }
        #toast.show {
            bottom: 30px;
            transform: translateX(-50%) scale(1);
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 100%;
            max-width: 350px;
            height: 100%;
            background-color: var(--bg-secondary);
            box-shadow: -10px 0 30px rgba(0,0,0,0.1);
            z-index: 1100;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 1.5rem;
            overflow-y: auto;
            border-left: 1px solid var(--border-color);
        }
        .settings-panel.active {
            right: 0;
        }
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--accent-primary);
        }
        input:checked + .slider:before {
            transform: translateX(22px);
        }
        
        .direction-btn {
            transition: all 0.2s ease-in-out;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border: 2px solid transparent;
            flex: 1;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        .direction-btn.selected-long {
            background-color: var(--success-bg);
            color: var(--success-color);
            border-color: var(--success-border);
            box-shadow: 0 0 15px -5px var(--success-bg);
        }
        .direction-btn.selected-short {
            background-color: var(--danger-bg);
            color: var(--danger-color);
            border-color: var(--danger-border);
            box-shadow: 0 0 15px -5px var(--danger-bg);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="app" class="container">
        <header class="main-header animate-fade-in-up">
            <h1 class="main-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –°–¥–µ–ª–æ–∫</h1>
            <div class="flex items-center gap-4">
                 <button id="settings-btn" class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </button>
            </div>
        </header>

        <div id="header-actions" class="flex flex-col sm:flex-row justify-start space-y-4 sm:space-y-0 sm:space-x-4 mb-8 animate-fade-in-up" style="animation-delay: 100ms;">
            <button id="create-statistic-btn" class="btn btn-primary">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                –°–æ–∑–¥–∞—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            </button>
            <button id="add-trade-btn" class="btn btn-secondary">
                –î–æ–±–∞–≤–∏—Ç—å –°–¥–µ–ª–∫—É
            </button>
        </div>

        <div id="statistics-overview">
            <div id="statistics-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="no-statistics-message" class="text-center text-gray-500 text-xl mt-16 hidden">
                <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫. –ù–∞—á–Ω–∏—Ç–µ —Å —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π!</p>
            </div>
        </div>

        <div id="trade-detail-view" class="hidden">
            <button id="back-to-stats-btn" class="btn btn-secondary mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                –ù–∞–∑–∞–¥
            </button>
            <h2 id="detail-statistic-name" class="text-3xl font-bold mb-6"></h2>
            <div class="flex flex-wrap gap-4 mb-6">
                <button id="copy-current-statistic-btn" class="btn btn-secondary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="show-results-btn" class="btn btn-secondary">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            </div>
            <div id="trade-list" class="space-y-4"></div>
            <div id="no-trades-message" class="text-center text-gray-500 text-xl mt-16 hidden">
                <p>–í —ç—Ç–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–¥–µ–ª–æ–∫.</p>
            </div>
        </div>
    </div>

    <div id="create-statistic-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" data-modal-id="create-statistic-modal">&times;</button>
            <h2 id="create-statistic-modal-title" class="modal-title">–°–æ–∑–¥–∞—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</h2>
            <form id="create-statistic-form">
                <div class="form-group">
                    <label for="statistic-name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</label>
                    <input type="text" id="statistic-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–∏ –°–¥–µ–ª–∫–∏" required>
                </div>
                <button type="submit" id="create-statistic-submit-btn" class="btn btn-primary w-full">–°–æ–∑–¥–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="add-trade-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" data-modal-id="add-trade-modal">&times;</button>
            <h2 id="add-trade-modal-title" class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –°–¥–µ–ª–∫—É</h2>
            <form id="add-trade-form" class="space-y-4">
                <div class="form-group" id="select-statistic-container">
                    <label for="select-statistic" class="form-label">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</label>
                    <select id="select-statistic" class="form-select" required></select>
                </div>
                <div class="form-group">
                    <label for="coin-name" class="form-label">–ú–æ–Ω–µ—Ç–∞</label>
                    <input type="text" id="coin-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: BTC/USDT" required>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="entry-price" class="form-label">–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞</label>
                        <input type="number" step="any" id="entry-price" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="margin" class="form-label">–ú–∞—Ä–∂–∞ (X)</label>
                        <input type="number" step="any" id="margin" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label>
                    <div id="direction-selector" class="flex rounded-lg border border-[var(--border-color)] p-1 space-x-1">
                        <button type="button" data-value="long" class="direction-btn">LONG</button>
                        <button type="button" data-value="short" class="direction-btn">SHORT</button>
                    </div>
                    <input type="hidden" id="direction-hidden-input" name="direction">
                </div>
                <div class="form-group">
                    <label class="form-label">–§–∏–∫—Å–∞—Ü–∏–∏</label>
                    <div id="fixations-container" class="space-y-2"></div>
                    <p id="fixation-total-warning" class="text-red-500 text-sm mt-2 hidden">–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Ñ–∏–∫—Å–∞—Ü–∏–π –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 100%.</p>
                </div>
                <button type="submit" id="add-trade-submit-btn" class="btn btn-primary w-full mt-4">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content text-center">
            <h3 id="confirmation-message" class="text-xl font-semibold mb-6">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</h3>
            <div class="flex justify-center gap-4">
                <button id="confirm-yes-btn" class="btn bg-red-600 text-white hover:bg-red-700">–î–∞</button>
                <button id="confirm-no-btn" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <div id="results-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-button" data-modal-id="results-modal">&times;</button>
            <h2 class="modal-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div id="results-content" class="space-y-3 text-lg text-center"></div>
        </div>
    </div>
    
    <div id="settings-panel" class="settings-panel">
        <div class="settings-header">
            <h3 class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <button id="close-settings-btn" class="close-button">&times;</button>
        </div>
        <div class="space-y-6">
            <div class="form-group">
                <label class="form-label flex justify-between items-center">
                    <span>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </label>
            </div>
            <div class="form-group">
                <label class="form-label flex justify-between items-center">
                    <span>–û—Ç–∫–ª—é—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="animations-toggle">
                        <span class="slider"></span>
                    </label>
                </label>
            </div>
            <div class="form-group">
                <label for="sort-trades-by" class="form-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–¥–µ–ª–∫–∏ –ø–æ</label>
                <select id="sort-trades-by" class="form-select">
                    <option value="date_desc">–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                    <option value="date_asc">–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                    <option value="profit_desc">–°–∞–º—ã–µ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ</option>
                    <option value="profit_asc">–°–∞–º—ã–µ —É–±—ã—Ç–æ—á–Ω—ã–µ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="default-margin" class="form-label">–ú–∞—Ä–∂–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</label>
                <input type="number" id="default-margin" class="form-input" placeholder="1">
            </div>
            <div class="space-y-3">
                <button id="export-data-btn" class="btn btn-secondary w-full">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <button id="import-data-btn" class="btn btn-secondary w-full">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <input type="file" id="import-file-input" class="hidden" accept=".json">
            </div>
            <div class="border-t border-dashed pt-6 mt-6 space-y-3 border-red-500/50">
                 <button id="delete-all-stats-btn" class="btn bg-red-600/10 text-red-500 hover:bg-red-600/20 w-full">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</button>
                 <button id="clear-memory-btn" class="btn bg-red-600/10 text-red-500 hover:bg-red-600/20 w-full">–û—á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let statistics = {};
            let currentStatisticId = null;
            let currentEditingTrade = null;
            let currentEditingStatisticIdForName = null;
            let confirmationCallback = null;
            let addTradeInitiatedCreateStatistic = false;
            let settings = {};

            const $ = (selector) => document.querySelector(selector);
            const $$ = (selector) => document.querySelectorAll(selector);

            const VLADOV_STATISTIC_NAME = "–ò–ª—å—è –í–ª–∞—Å–æ–≤ - –ì—Ä–∞–±–∏—Ç–µ–ª—å –ú–ú";
            const ALL_USER_PROVIDED_TRADES_TEXT = `INJ (long)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.21%
ENTRY: 11.345
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 11.425 (30%) 11.345 (70%)
18.06.25
üìÖ

LINK (short)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.18%
ENTRY: 12.925
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 12.772 (100%)
18.06.25
üìÖ

AVAX (short)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 268.25
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 268.25 (100%)
17.06.25
üìÖ

ZKJ (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.24%
ENTRY: 0.4394
–ú–∞—Ä–∂–∞: X0.25
–§–∏–∫—Å–∞—Ü–∏–∏: 0.4 (100%)
–î–∞—Ç–∞: 17.06.25

PNUT (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 0.24207
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.24207 (100%)
–î–∞—Ç–∞: 16.06.25

JTO (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -3.35%
ENTRY: 2.164
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 2.2366 (100%)
–î–∞—Ç–∞: 15.06.25

AAVE (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.49%
ENTRY: 276.61
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 269.72 (100%)
–î–∞—Ç–∞: 15.06.25

LINK (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -4.45%
ENTRY: 13.544
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 12.941 (100%)
–î–∞—Ç–∞: 13.06.25

UNI (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 7.25%
ENTRY: 7.926
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 7.638 (30%) 7.229 (70%)
–î–∞—Ç–∞: 12.06.25

AVAAI (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.16%
ENTRY: 0.03954
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.04107 (30%)
–î–∞—Ç–∞: 08.06.25

LINK (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 6.43%
ENTRY: 13.819
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 14.446 (30%) 14.819 (70%)
–î–∞—Ç–∞: 08.06.25

WIF (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -3.36%
ENTRY: 0.8963
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.8662 (100%)
–î–∞—Ç–∞: 07.06.25

FARTCOIN (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.68%
ENTRY: 0.9951
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 1.0509 (30%)
–î–∞—Ç–∞: 07.06.25

POPCAT (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.31%
ENTRY: 0.3463
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.3614 (30%)
–î–∞—Ç–∞: 07.06.25

FARTCOIN (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.38%
ENTRY: 1.0507
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 1.0007 (100%)
–î–∞—Ç–∞: 06.06.25

LQTY (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 6.44%
ENTRY: 0.09687
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.09063 (100%)
–î–∞—Ç–∞: 05.06.25

APE (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 6.77%
ENTRY: 0.7417
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.7015 (50%) 0.6815 (50%)
–î–∞—Ç–∞: 04.06.25

ARC –ø–µ—Ä–µ–∑–∞—Ö–æ–¥ (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 7.15%
ENTRY: 0.04487
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.04166 (100%)
–î–∞—Ç–∞: 04.06.25

ARC (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 0.04482
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.04482 (100%)
–î–∞—Ç–∞: 04.06.25

FARTCOIN (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -1.62%
ENTRY: 1.085
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 1.1201 (100%)
–î–∞—Ç–∞: 02.06.25

AVAX (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 20.498
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 20.498 (100%)
–î–∞—Ç–∞: 31.05.25

AAVE (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -3.35%
ENTRY: 252.19
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 243.74 (100%)
–î–∞—Ç–∞: 30.05.25

INJ (—Å–∫–∞–ª—å–ø) (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 13.112
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 13.112 (100%)
–î–∞—Ç–∞: 30.05.25

Ondo (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 5.35%
ENTRY: 0.9014
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.8731 (50%) 0.8332 (50%)
–î–∞—Ç–∞: 30.05.25

INJ (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.69%
ENTRY: 14.124
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 13.8 (30%)
–î–∞—Ç–∞: 30.05.25

WIF (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 6.44%
ENTRY: 1.0681
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.9993 (100%)
–î–∞—Ç–∞: 29.05.25

FARTCOIN (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 3.53%
ENTRY: 1.2424
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 1.1547 (100%)
–î–∞—Ç–∞: 29.05.25

PEPE (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 5.65%
ENTRY: 0.0000140714
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.0000136603 (30%) 0.0000131119 (70%)
–î–∞—Ç–∞: 29.05.25

AAVE (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.85%
ENTRY: 261.31
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 268.77 (100%)
–î–∞—Ç–∞: 28.05.25

SUI (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -3.28%
ENTRY: 3.5275
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 3.6432 (100%)
–î–∞—Ç–∞: 28.05.25

TURBO (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 0.005209
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.005209 (100%)
–î–∞—Ç–∞: 28.05.25

LDO (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 2.23%
ENTRY: 0.9091
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.9496 (50%)
–î–∞—Ç–∞: 27.05.25

ai16Z (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 5.61%
ENTRY: 0.3014
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.3183 (100%)
–î–∞—Ç–∞: 27.05.25

RUNE (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -1.97%
ENTRY: 1.98
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 1.941 (100%)
–î–∞—Ç–∞: 26.05.25

FARTCOIN (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -1.82%
ENTRY: 1.514
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 1.4588 (100%)
–î–∞—Ç–∞: 23.05.25

Ethfi (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -4.04%
ENTRY: 1.2933
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 1.2411 (100%)
–î–∞—Ç–∞: 23.05.25

Fartcoin (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.55%
ENTRY: 1.5518
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 1.6319 (30%)
–î–∞—Ç–∞: 23.05.25

Aixbt (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 4.63%
ENTRY: 0.18543
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.1917 (30%) 0.195 (70%)
–î–∞—Ç–∞: 21.05.25

WCT (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.58%
ENTRY: 0.6911
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 0.6554 (100%)
–î–∞—Ç–∞: 21.05.25

Griffain (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 4.47%
ENTRY: 0.10263
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 0.1118 (100%)
–î–∞—Ç–∞: 20.05.25

AAVE (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 7.10%
ENTRY: 224.67
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 233.17 (30%) 243.8 (70%)
–î–∞—Ç–∞: 19.05.25

LINK (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 5.86%
ENTRY: 15.287
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 15.722 (30%) 16.38 (70%)
–î–∞—Ç–∞: 19.05.25

GRIFFAIN (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.34%
ENTRY: 0.10511
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 0.1004 (30%)
–î–∞—Ç–∞: 18.05.25

UNI (–õ–æ–Ω–≥)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 1.79%
ENTRY: 5.763
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 5.969 (100%)
–î–∞—Ç–∞: 17.05.25

PEPE (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: -2.29%
ENTRY: 0.0000123186
–ú–∞—Ä–∂–∞: X0.5
–§–∏–∫—Å–∞—Ü–∏–∏: 0.0000128829 (100%)
–î–∞—Ç–∞: 17.05.25

AVAX (–®–æ—Ä—Ç)
–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: 0.00%
ENTRY: 22.566
–ú–∞—Ä–∂–∞: X1
–§–∏–∫—Å–∞—Ü–∏–∏: 22.566 (100%)
–î–∞—Ç–∞: 17.05.25`;

            const app = {
                init() {
                    this.loadSettings();
                    this.applySettings();
                    this.loadData();
                    this.renderStatisticsList();
                    this.attachEventListeners();
                    if (currentStatisticId && Object.keys(statistics).length === 1) {
                        this.renderTradeDetail(currentStatisticId);
                    }
                },

                attachEventListeners() {
                    $('#create-statistic-btn').addEventListener('click', () => this.openModal('create-statistic-modal'));
                    $('#add-trade-btn').addEventListener('click', () => this.handleAddTradeClick());
                    $('#back-to-stats-btn').addEventListener('click', () => this.showStatisticsOverview());
                    $('#create-statistic-form').addEventListener('submit', (e) => this.handleStatisticFormSubmit(e));
                    $('#add-trade-form').addEventListener('submit', (e) => this.handleTradeFormSubmit(e));
                    $('#confirm-yes-btn').addEventListener('click', () => this.handleConfirmYes());
                    $('#confirm-no-btn').addEventListener('click', () => this.closeModal('confirmation-modal'));
                    $('#copy-current-statistic-btn').addEventListener('click', () => this.copyCurrentStatistic());
                    $('#show-results-btn').addEventListener('click', () => this.showResults(currentStatisticId));
                    $('#settings-btn').addEventListener('click', () => $('#settings-panel').classList.add('active'));
                    $('#close-settings-btn').addEventListener('click', () => $('#settings-panel').classList.remove('active'));
                    $('#theme-toggle').addEventListener('change', (e) => this.updateSetting('theme', e.target.checked ? 'dark' : 'light'));
                    $('#animations-toggle').addEventListener('change', (e) => this.updateSetting('animationsDisabled', e.target.checked));
                    $('#sort-trades-by').addEventListener('change', (e) => this.updateSetting('sortTradesBy', e.target.value));
                    $('#default-margin').addEventListener('input', (e) => this.updateSetting('defaultMargin', e.target.value));
                    $('#export-data-btn').addEventListener('click', () => this.exportData());
                    $('#import-data-btn').addEventListener('click', () => $('#import-file-input').click());
                    $('#import-file-input').addEventListener('change', (e) => this.importData(e));
                    $('#delete-all-stats-btn').addEventListener('click', () => this.confirmAction('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏?', () => this.deleteAllStatistics()));
                    $('#clear-memory-btn').addEventListener('click', () => this.confirmAction('–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?', () => this.clearMemory()));
                    
                    document.body.addEventListener('click', (e) => {
                        if (e.target.classList.contains('modal-overlay')) {
                            this.closeAllModals();
                        }
                        const settingsPanel = $('#settings-panel');
                        if (settingsPanel.classList.contains('active') && !settingsPanel.contains(e.target) && !e.target.closest('#settings-btn')) {
                            settingsPanel.classList.remove('active');
                        }
                        if (e.target.classList.contains('close-button')) {
                            this.closeModal(e.target.dataset.modalId);
                        }
                        if (e.target.closest('.statistic-card')) {
                            const card = e.target.closest('.statistic-card');
                            const id = card.dataset.id;
                            if (e.target.closest('.edit-statistic-name-btn')) {
                                this.editStatisticName(id);
                            } else if (e.target.closest('.delete-statistic-btn')) {
                                this.confirmAction('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –≤—Å–µ –µ–µ —Å–¥–µ–ª–∫–∏?', () => this.deleteStatistic(id));
                            } else {
                                currentStatisticId = id;
                                this.renderTradeDetail(id);
                            }
                        }
                        if (e.target.closest('.add-fixation-btn')) {
                            this.addFixationField();
                        }
                        if (e.target.closest('.remove-fixation-btn')) {
                            this.removeFixationField(e.target.closest('.remove-fixation-btn'));
                        }
                        if (e.target.closest('.copy-trade-single-btn')) {
                            const tradeId = e.target.closest('.copy-trade-single-btn').dataset.tradeId;
                            this.copySingleTrade(tradeId);
                        }
                        if (e.target.closest('.edit-trade-btn')) {
                            const tradeId = e.target.closest('.edit-trade-btn').dataset.tradeId;
                            this.editTrade(currentStatisticId, tradeId);
                        }
                        if (e.target.closest('.delete-trade-btn')) {
                            const tradeId = e.target.closest('.delete-trade-btn').dataset.tradeId;
                            this.confirmAction('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–¥–µ–ª–∫—É?', () => this.deleteTrade(currentStatisticId, tradeId));
                        }
                         if (e.target.matches('.direction-btn')) {
                            this.handleDirectionSelection(e.target);
                        }
                    });
                     document.body.addEventListener('change', (e) => {
                        if (e.target.classList.contains('trade-date-input')) {
                            const tradeId = e.target.closest('.trade-card').dataset.tradeId;
                            this.updateTradeDate(currentStatisticId, tradeId, e.target.value);
                        }
                    });
                },
                
                loadSettings() {
                    const savedSettings = localStorage.getItem('tradeStatisticsSettings');
                    const defaultSettings = {
                        theme: 'light',
                        animationsDisabled: false,
                        sortTradesBy: 'date_desc',
                        defaultMargin: 1,
                    };
                    settings = savedSettings ? JSON.parse(savedSettings) : defaultSettings;
                },

                saveSettings() {
                    localStorage.setItem('tradeStatisticsSettings', JSON.stringify(settings));
                },
                
                updateSetting(key, value) {
                    settings[key] = value;
                    this.saveSettings();
                    this.applySettings();
                    if (key === 'sortTradesBy' && currentStatisticId) {
                        this.renderTradeDetail(currentStatisticId);
                    }
                },

                applySettings() {
                    document.documentElement.setAttribute('data-theme', settings.theme);
                    $('#theme-toggle').checked = settings.theme === 'dark';
                    
                    document.body.classList.toggle('animations-disabled', settings.animationsDisabled);
                    $('#animations-toggle').checked = settings.animationsDisabled;

                    $('#sort-trades-by').value = settings.sortTradesBy;
                    $('#default-margin').value = settings.defaultMargin;
                },

                loadData() {
                    const storedData = localStorage.getItem('tradeStatistics');
                    if (storedData) {
                        statistics = JSON.parse(storedData);
                    } else {
                        this.initializeVlasovStatistic();
                    }
                },

                saveData() {
                    localStorage.setItem('tradeStatistics', JSON.stringify(statistics));
                },
                
                initializeVlasovStatistic() {
                    const vlasovId = `stat-${crypto.randomUUID()}`;
                    statistics[vlasovId] = {
                        name: VLADOV_STATISTIC_NAME,
                        trades: this.parseAllTradesFromProvidedText(ALL_USER_PROVIDED_TRADES_TEXT)
                    };
                    currentStatisticId = vlasovId;
                    this.saveData();
                },
                
                renderStatisticsList() {
                    const listContainer = $('#statistics-list');
                    listContainer.innerHTML = '';
                    const statisticIds = Object.keys(statistics);

                    $('#add-trade-btn').style.display = statisticIds.length > 0 ? 'inline-flex' : 'none';
                    $('#no-statistics-message').classList.toggle('hidden', statisticIds.length > 0);
                    listContainer.classList.toggle('hidden', statisticIds.length === 0);

                    statisticIds.forEach((id, index) => {
                        const stat = statistics[id];
                        const metrics = this.calculateStatisticMetrics(id);
                        const winRateColor = metrics.winRate > 50 ? 'color-green' : metrics.winRate < 50 ? 'color-red' : 'color-gray';
                        const netMoveColor = metrics.totalNetMovement > 0 ? 'color-green' : metrics.totalNetMovement < 0 ? 'color-red' : 'color-gray';

                        const card = document.createElement('div');
                        card.className = 'statistic-card';
                        card.dataset.id = id;
                        card.style.animationDelay = `${index * 70}ms`;
                        card.innerHTML = `
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold pr-2">${stat.name}</h3>
                                <div class="flex-shrink-0 flex gap-1">
                                    <button class="edit-statistic-name-btn p-1.5 rounded-md hover:bg-[var(--gray-bg)]" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path></svg></button>
                                    <button class="delete-statistic-btn p-1.5 rounded-md hover:bg-[var(--gray-bg)] text-red-500" title="–£–¥–∞–ª–∏—Ç—å"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                                </div>
                            </div>
                            <div class="text-sm text-[var(--text-secondary)] mb-4">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: ${metrics.totalTrades}</div>
                            <div class="flex justify-between items-end text-sm">
                                <div>
                                    <div class="text-[var(--text-secondary)]">–í–∏–Ω—Ä–µ–π—Ç</div>
                                    <div class="font-bold text-lg ${winRateColor}">${metrics.winRate.toFixed(2)}%</div>
                                </div>
                                <div>
                                    <div class="text-[var(--text-secondary)]">–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</div>
                                    <div class="font-bold text-lg ${netMoveColor}">${metrics.totalNetMovement.toFixed(2)}%</div>
                                </div>
                            </div>`;
                        listContainer.appendChild(card);
                        card.classList.add('animate-fade-in-up');
                    });
                },
                
                renderTradeDetail(statisticId) {
                    $('#statistics-overview').classList.add('hidden');
                    $('#trade-detail-view').classList.remove('hidden');

                    const stat = statistics[statisticId];
                    $('#detail-statistic-name').textContent = stat.name;
                    const tradeListContainer = $('#trade-list');
                    tradeListContainer.innerHTML = '';
                    
                    if (!stat.trades || stat.trades.length === 0) {
                        $('#no-trades-message').classList.remove('hidden');
                        return;
                    }
                    
                    $('#no-trades-message').classList.add('hidden');

                    const sortedTrades = this.sortTrades([...stat.trades]);

                    sortedTrades.forEach((trade, index) => {
                        const metrics = this.calculateTradeMetrics(trade);
                        trade.netMovement = metrics.netMovement;
                        
                        const profitLossClass = trade.netMovement > 0 ? 'profit-loss-green' : trade.netMovement < 0 ? 'profit-loss-red' : 'profit-loss-gray';
                        const fixationsString = trade.fixations.map(f => `${f.price} (${f.percent}%)`).join(' ');
                        const directionText = trade.direction === 'long' ? '<span class="color-green">long</span>' : '<span class="color-red">short</span>';
                        const dateValue = trade.date ? new Date(trade.date).toISOString().split('T')[0] : '';

                        const newCard = document.createElement('div');
                        newCard.className = 'trade-card';
                        newCard.dataset.tradeId = trade.id;
                        newCard.style.animationDelay = `${index * 50}ms`;
                        newCard.innerHTML = `
                            <div class="flex justify-between items-start gap-4">
                                <div>
                                    <h4 class="text-lg font-semibold">${trade.coin} (${directionText})</h4>
                                    <div class="text-sm text-[var(--text-secondary)] mt-1">
                                        ENTRY: ${trade.entry} &bull; –ú–∞—Ä–∂–∞: X${trade.margin}
                                    </div>
                                </div>
                                <span class="px-3 py-1 rounded-full text-sm font-bold ${profitLossClass} flex-shrink-0">
                                    ${trade.netMovement.toFixed(2)}%
                                </span>
                            </div>
                            <div class="text-sm text-[var(--text-secondary)] mt-3">–§–∏–∫—Å–∞—Ü–∏–∏: ${fixationsString}</div>
                            <div class="flex justify-between items-center mt-4">
                                 <input type="date" value="${dateValue}" class="trade-date-input bg-transparent border-none p-0 text-[var(--text-secondary)]" title="–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞—Ç—É">
                                 <div class="flex gap-1">
                                    <button class="copy-trade-single-btn p-1.5 rounded-md hover:bg-[var(--gray-bg)]" data-trade-id="${trade.id}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button>
                                    <button class="delete-trade-btn p-1.5 rounded-md hover:bg-[var(--gray-bg)] text-red-500" data-trade-id="${trade.id}"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"></path><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>
                                 </div>
                            </div>`;
                        
                        newCard.addEventListener('click', (e) => {
                            if (e.target.closest('button') || e.target.closest('input')) {
                                return;
                            }
                            this.copySingleTrade(trade.id);
                        });

                        tradeListContainer.appendChild(newCard);
                        newCard.classList.add('animate-fade-in-up');
                    });
                },
                
                sortTrades(trades) {
                    const sortOrder = settings.sortTradesBy;
                    return trades.sort((a, b) => {
                        const aTimestamp = a.timestamp || 0;
                        const bTimestamp = b.timestamp || 0;
                        const aNetMovement = a.netMovement || 0;
                        const bNetMovement = b.netMovement || 0;

                        switch (sortOrder) {
                            case 'date_asc': return aTimestamp - bTimestamp;
                            case 'profit_desc': return bNetMovement - aNetMovement;
                            case 'profit_asc': return aNetMovement - bNetMovement;
                            case 'date_desc':
                            default:
                                return bTimestamp - aTimestamp;
                        }
                    });
                },

                calculateTradeMetrics(trade) {
                    let totalContribution = 0;
                    if (trade.fixations && trade.fixations.length > 0) {
                        trade.fixations.forEach(fix => {
                            const price = parseFloat(fix.price);
                            const percent = parseFloat(fix.percent);
                            if (isNaN(price) || isNaN(percent) || percent === 0) return;
                            const entry = parseFloat(trade.entry);
                            let movementDecimal = trade.direction === 'long' ? (price - entry) / entry : (entry - price) / entry;
                            totalContribution += movementDecimal * (percent / 100);
                        });
                    }
                    const netMovementPercentage = totalContribution * 100 * parseFloat(trade.margin || 1);
                    return { netMovement: netMovementPercentage };
                },

                calculateStatisticMetrics(statisticId) {
                    const stat = statistics[statisticId];
                    if (!stat || !stat.trades || stat.trades.length === 0) {
                        return { totalTrades: 0, profitableTrades: 0, rejectedTrades: 0, breakevenTrades: 0, winRate: 0, totalNetMovement: 0 };
                    }
                    let profitableTrades = 0, rejectedTrades = 0, breakevenTrades = 0, totalNetMovement = 0;
                    stat.trades.forEach(trade => {
                        const metrics = this.calculateTradeMetrics(trade);
                        trade.netMovement = metrics.netMovement;
                        if (trade.netMovement > 0) profitableTrades++;
                        else if (trade.netMovement < 0) rejectedTrades++;
                        else breakevenTrades++;
                        totalNetMovement += trade.netMovement;
                    });
                    
                    const winRate = (stat.trades.length > 0) ? (profitableTrades / stat.trades.length) * 100 : 0;
                    return { totalTrades: stat.trades.length, profitableTrades, rejectedTrades, breakevenTrades, winRate, totalNetMovement };
                },

                parseAllTradesFromProvidedText(text) {
                    const trades = [];
                    const blocks = text.split('\n\n').filter(block => block.trim().length > 0);

                    blocks.forEach((block, index) => {
                        const lines = block.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                        if (lines.length === 0) return;

                        let trade = { fixations: [] };
                        const firstLine = lines[0];
                        const coinDirectionMatch = firstLine.match(/^(.+?)\s*\((–õ–æ–Ω–≥|–®–æ—Ä—Ç|short|long|—Å–∫–∞–ª—å–ø)\)/i);

                        if (coinDirectionMatch) {
                            trade.coin = coinDirectionMatch[1].trim().toUpperCase();
                            let direction = coinDirectionMatch[2].trim().toLowerCase();
                            trade.direction = (direction === '–ª–æ–Ω–≥' || direction === 'long' || direction === '—Å–∫–∞–ª—å–ø') ? 'long' : 'short';
                        } else {
                            return; 
                        }

                        lines.slice(1).forEach(line => {
                            if (line.startsWith('ENTRY:')) {
                                trade.entry = parseFloat(line.replace('ENTRY:', '').trim());
                            } else if (line.startsWith('–ú–∞—Ä–∂–∞:')) {
                                trade.margin = parseFloat(line.replace('–ú–∞—Ä–∂–∞:', '').replace('X', '').trim());
                            } else if (line.startsWith('–§–∏–∫—Å–∞—Ü–∏–∏:')) {
                                const fixationsString = line.replace('–§–∏–∫—Å–∞—Ü–∏–∏:', '').trim();
                                const fixationMatches = fixationsString.matchAll(/(\d+\.?\d*)\s*\((\d+\.?\d*)\%\)/g);
                                for (const match of fixationMatches) {
                                    trade.fixations.push({ price: parseFloat(match[1]), percent: parseFloat(match[2]) });
                                }
                            } else if (line.match(/^\d{2}\.\d{2}\.\d{2}$/) || line.startsWith('–î–∞—Ç–∞:')) {
                                const dateString = line.replace('–î–∞—Ç–∞:', '').trim();
                                const parts = dateString.split('.');
                                if (parts.length === 3) {
                                    trade.date = new Date(`20${parts[2]}`, parts[1] - 1, parts[0]).toISOString();
                                }
                            }
                        });
                        
                        trade.id = `trade-${crypto.randomUUID()}`;
                        const metrics = this.calculateTradeMetrics(trade);
                        trade.netMovement = metrics.netMovement;
                        trade.timestamp = new Date(trade.date || Date.now() - index * 1000).getTime();
                        trades.push(trade);
                    });
                    return trades;
                },
                
                openModal(modalId) {
                    const modal = $(`#${modalId}`);
                    if (modal) {
                        modal.classList.add('active');
                        if (modalId === 'add-trade-modal') {
                            this.resetAddTradeForm();
                        }
                    }
                },
                
                closeModal(modalId) {
                    const modal = $(`#${modalId}`);
                    if (modal) modal.classList.remove('active');
                },

                closeAllModals() {
                    $$('.modal-overlay').forEach(modal => modal.classList.remove('active'));
                },
                
                showToast(message) {
                    const toast = $('#toast');
                    toast.textContent = message;
                    toast.classList.add('show');
                    setTimeout(() => toast.classList.remove('show'), 3000);
                },

                confirmAction(message, callback) {
                    $('#confirmation-message').textContent = message;
                    confirmationCallback = callback;
                    this.openModal('confirmation-modal');
                },
                
                handleConfirmYes() {
                    if (confirmationCallback) confirmationCallback();
                    this.closeModal('confirmation-modal');
                },

                handleStatisticFormSubmit(e) {
                    e.preventDefault();
                    const statisticName = $('#statistic-name').value.trim();
                    if (!statisticName) return;
                    let newStatisticId = null;
                    if (currentEditingStatisticIdForName) {
                        statistics[currentEditingStatisticIdForName].name = statisticName;
                        currentEditingStatisticIdForName = null;
                    } else {
                        newStatisticId = `stat-${crypto.randomUUID()}`;
                        statistics[newStatisticId] = { name: statisticName, trades: [] };
                    }
                    this.saveData();
                    this.renderStatisticsList();
                    this.closeModal('create-statistic-modal');
                    if (addTradeInitiatedCreateStatistic && newStatisticId) {
                        this.populateStatisticSelect(newStatisticId);
                        this.openModal('add-trade-modal');
                        addTradeInitiatedCreateStatistic = false;
                    }
                },
                
                handleTradeFormSubmit(e) {
                    e.preventDefault();
                    const selectedStatisticId = $('#select-statistic').value;
                    const coinName = $('#coin-name').value.trim().toUpperCase();
                    const direction = $('#direction-hidden-input').value;
                    const entryPrice = parseFloat($('#entry-price').value);
                    const margin = parseFloat($('#margin').value);

                    let fixations = [], totalFixationPercent = 0;
                    $$('#fixations-container .flex').forEach(row => {
                        const price = parseFloat(row.querySelector('.fixation-price').value);
                        const percent = parseFloat(row.querySelector('.fixation-percent').value);
                        if (!isNaN(price) && !isNaN(percent)) {
                            fixations.push({ price, percent });
                            totalFixationPercent += percent;
                        }
                    });

                    if (totalFixationPercent > 100.001) {
                        $('#fixation-total-warning').classList.remove('hidden');
                        return;
                    }
                    $('#fixation-total-warning').classList.add('hidden');

                    const targetStatisticId = currentEditingTrade ? currentStatisticId : selectedStatisticId;
                    if (!targetStatisticId || !coinName || isNaN(entryPrice) || isNaN(margin) || !direction) return;

                    if (currentEditingTrade) {
                        const tradeIndex = statistics[currentStatisticId].trades.findIndex(t => t.id === currentEditingTrade.id);
                        if (tradeIndex !== -1) {
                            const tradeToUpdate = statistics[currentStatisticId].trades[tradeIndex];
                            Object.assign(tradeToUpdate, { coin: coinName, direction, entry: entryPrice, fixations, margin, timestamp: tradeToUpdate.timestamp });
                        }
                    } else {
                        const newTrade = { id: `trade-${crypto.randomUUID()}`, coin: coinName, direction, entry: entryPrice, fixations, margin, date: new Date().toISOString(), timestamp: Date.now() };
                        statistics[targetStatisticId].trades.push(newTrade);
                    }
                    
                    this.saveData();
                    this.renderStatisticsList();
                    this.closeModal('add-trade-modal');
                    if (currentStatisticId === targetStatisticId) {
                        this.renderTradeDetail(currentStatisticId);
                    }
                },
                
                handleAddTradeClick() {
                    const statIds = Object.keys(statistics);
                    if (statIds.length === 0) {
                        addTradeInitiatedCreateStatistic = true;
                        this.openModal('create-statistic-modal');
                        return;
                    }
                    this.populateStatisticSelect();
                    if (statIds.length === 1) {
                        $('#select-statistic').value = statIds[0];
                    }
                    this.openModal('add-trade-modal');
                },
                
                showStatisticsOverview() {
                    $('#trade-detail-view').classList.add('hidden');
                    $('#statistics-overview').classList.remove('hidden');
                    this.renderStatisticsList();
                },

                editStatisticName(id) {
                    currentEditingStatisticIdForName = id;
                    const stat = statistics[id];
                    $('#create-statistic-modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É';
                    $('#create-statistic-submit-btn').textContent = '–û–±–Ω–æ–≤–∏—Ç—å';
                    $('#statistic-name').value = stat.name;
                    this.openModal('create-statistic-modal');
                },

                deleteStatistic(id) {
                    delete statistics[id];
                    this.saveData();
                    this.renderStatisticsList();
                    if (currentStatisticId === id) {
                        this.showStatisticsOverview();
                        currentStatisticId = null;
                    }
                },
                
                editTrade(statisticId, tradeId) {
                    currentEditingTrade = statistics[statisticId].trades.find(t => t.id === tradeId);
                    if (!currentEditingTrade) return;

                    $('#add-trade-modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –°–¥–µ–ª–∫—É';
                    $('#add-trade-submit-btn').textContent = '–û–±–Ω–æ–≤–∏—Ç—å';
                    $('#select-statistic-container').classList.add('hidden');
                    
                    $('#coin-name').value = currentEditingTrade.coin;
                    this.setDirectionSelector(currentEditingTrade.direction);
                    $('#entry-price').value = currentEditingTrade.entry;
                    $('#margin').value = currentEditingTrade.margin;

                    const fixationsContainer = $('#fixations-container');
                    fixationsContainer.innerHTML = '';
                    currentEditingTrade.fixations.forEach(fix => this.addFixationField(fix.price, fix.percent));
                    if (currentEditingTrade.fixations.length === 0) this.addFixationField();
                    
                    this.openModal('add-trade-modal');
                },
                
                deleteTrade(statisticId, tradeId) {
                    const stat = statistics[statisticId];
                    if (stat) {
                        stat.trades = stat.trades.filter(t => t.id !== tradeId);
                        this.saveData();
                        this.renderTradeDetail(statisticId);
                        this.renderStatisticsList();
                    }
                },
                
                updateTradeDate(statisticId, tradeId, newDateString) {
                    const trade = statistics[statisticId]?.trades.find(t => t.id === tradeId);
                    if (trade) {
                        trade.date = newDateString ? new Date(newDateString).toISOString() : null;
                        trade.timestamp = newDateString ? new Date(newDateString).getTime() : Date.now();
                        this.saveData();
                        this.renderTradeDetail(statisticId);
                    }
                },
                
                resetAddTradeForm() {
                    $('#add-trade-form').reset();
                    $('#add-trade-modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –°–¥–µ–ª–∫—É';
                    $('#add-trade-submit-btn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
                    $('#select-statistic-container').classList.remove('hidden');
                    $('#fixations-container').innerHTML = '';
                    this.addFixationField();
                    $('#margin').value = settings.defaultMargin;
                    this.setDirectionSelector('long');
                    currentEditingTrade = null;
                },

                addFixationField(price = '', percent = '') {
                    const container = $('#fixations-container');
                    const isFirst = container.children.length === 0;
                    const newField = document.createElement('div');
                    newField.className = 'flex items-center gap-2';
                    newField.innerHTML = `
                        <input type="number" step="any" class="fixation-price form-input" placeholder="–¶–µ–Ω–∞" value="${price}">
                        <input type="number" step="any" min="0" max="100" class="fixation-percent form-input" placeholder="%" value="${percent}">
                        <button type="button" class="${isFirst ? 'add-fixation-btn text-green-500' : 'remove-fixation-btn text-red-500'} p-2 rounded-md hover:bg-[var(--gray-bg)]">
                            ${isFirst ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line></svg>'}
                        </button>
                    `;
                    container.appendChild(newField);
                },

                removeFixationField(button) {
                    button.closest('.flex').remove();
                },

                handleDirectionSelection(clickedButton) {
                    const value = clickedButton.dataset.value;
                    this.setDirectionSelector(value);
                },

                setDirectionSelector(value) {
                    $('#direction-hidden-input').value = value;
                    $$('.direction-btn').forEach(btn => {
                        btn.classList.remove('selected-long', 'selected-short');
                    });
                    const targetButton = $(`.direction-btn[data-value="${value}"]`);
                    if (targetButton) {
                        targetButton.classList.add(value === 'long' ? 'selected-long' : 'selected-short');
                    }
                },

                populateStatisticSelect(preSelectId = null) {
                    const select = $('#select-statistic');
                    select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É --</option>';
                    Object.keys(statistics).forEach(id => {
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = statistics[id].name;
                        select.appendChild(option);
                    });
                    if (preSelectId) select.value = preSelectId;
                },
                
                copyToClipboard(text) {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.style.position = 'fixed';
                    textarea.style.left = '-9999px';
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        this.showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    } catch (err) {
                        this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏');
                    } finally {
                        document.body.removeChild(textarea);
                    }
                },

                generateSingleTradeExportText(trade) {
                    const directionText = trade.direction === 'long' ? 'long' : 'short';
                    const fixationsString = trade.fixations.map(f => `${f.price} (${f.percent}%)`).join(' ');
                    const tradeDateString = trade.date ? new Date(trade.date).toLocaleDateString('ru-RU') : '–ù–µ—Ç –¥–∞—Ç—ã';
                    const metrics = this.calculateTradeMetrics(trade);
                    return `${trade.coin} (${directionText})\n–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: ${metrics.netMovement.toFixed(2)}%\nENTRY: ${trade.entry}\n–ú–∞—Ä–∂–∞: X${trade.margin}\n–§–∏–∫—Å–∞—Ü–∏–∏: ${fixationsString}\n–î–∞—Ç–∞: ${tradeDateString}`;
                },
                
                copySingleTrade(tradeId) {
                    const trade = statistics[currentStatisticId].trades.find(t => t.id === tradeId);
                    if(trade) this.copyToClipboard(this.generateSingleTradeExportText(trade));
                },

                copyCurrentStatistic() {
                    let exportContent = `--- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${statistics[currentStatisticId].name} ---\n\n`;
                    const sortedTrades = this.sortTrades([...statistics[currentStatisticId].trades]);
                    sortedTrades.forEach(trade => {
                        exportContent += this.generateSingleTradeExportText(trade) + '\n\n';
                    });
                    this.copyToClipboard(exportContent.trim());
                },
                
                showResults(statisticId) {
                    const metrics = this.calculateStatisticMetrics(statisticId);
                    const contentEl = $('#results-content');
                    contentEl.innerHTML = `
                        <p>–ß–∏—Å—Ç–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ: <span class="font-bold ${metrics.totalNetMovement > 0 ? 'color-green' : metrics.totalNetMovement < 0 ? 'color-red' : 'color-gray'}">${metrics.totalNetMovement.toFixed(2)}%</span></p>
                        <p>–í–∏–Ω—Ä–µ–π—Ç: <span class="font-bold ${metrics.winRate > 50 ? 'color-green' : metrics.winRate < 50 ? 'color-red' : 'color-gray'}">${metrics.winRate.toFixed(2)}%</span></p>
                        <p>–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: <span class="font-bold">${metrics.totalTrades}</span></p>
                        <p>–£—Å–ø–µ—à–Ω—ã—Ö: <span class="font-bold color-green">${metrics.profitableTrades}</span></p>
                        <p>–£–±—ã—Ç–æ—á–Ω—ã—Ö: <span class="font-bold color-red">${metrics.rejectedTrades}</span></p>
                        <p>–í –±–µ–∑—É–±—ã—Ç–æ–∫: <span class="font-bold color-gray">${metrics.breakevenTrades}</span></p>
                    `;
                    this.openModal('results-modal');
                },
                
                deleteAllStatistics() {
                    statistics = {};
                    this.saveData();
                    this.renderStatisticsList();
                    this.showStatisticsOverview();
                },
                
                clearMemory() {
                    localStorage.clear();
                    window.location.reload();
                },
                
                exportData() {
                    const dataStr = JSON.stringify({ statistics, settings }, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    const exportFileDefaultName = 'trade_stats_backup.json';
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                },

                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.statistics && data.settings) {
                                statistics = data.statistics;
                                settings = data.settings;
                                this.saveData();
                                this.saveSettings();
                                this.applySettings();
                                this.renderStatisticsList();
                                this.showStatisticsOverview();
                                this.showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                            } else {
                                this.showToast('–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
                            }
                        } catch (error) {
                            this.showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞.');
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                }
            };

            app.init();
        });
    </script>
</body>
</html>
